{"version":3,"file":"pullDownRefresh.cjs.js","sources":["../src/pullDownRefresh.js"],"sourcesContent":["let WIDTH = window.innerWidth,\r\n    HEIGHT = 100,\r\n    drawStyle = '#b1b1b1',\r\n    canvasTrm,\r\n    topOffSet, bottomOffSet,\r\n    r1, r2,\r\n    arc1, arc2,\r\n    arr1, arr2, arr3,\r\n    arr4, arr5, arr6,\r\n    y, y1, disY,\r\n    isLoad = false;\r\n\r\nlet callback;\r\n\r\nconst canvas = document.createElement('canvas'),\r\n\t  body = document.body;\r\n\t  canvas.width = WIDTH;\r\n\t  canvas.height = HEIGHT;\r\n\t  canvas.style.borderBottom = \"1px solid #ccc\";\r\n\t  // canvas.style.position = \"\"\r\n\t  body.style.transform = \"translate(0,-\" + HEIGHT + \"px)\";\r\nbody.insertBefore(canvas, body.firstChild);\r\n\r\n// console.log(canvas);\r\nconst context = canvas.getContext('2d');\r\n\r\nexport function init(opt) {\r\n\tcallback = opt.callback;\r\n    initData();\r\n    draw();\r\n}\r\n\r\nexport function end() {\r\n\t// console.log('end');\r\n\tmove(HEIGHT);\r\n\tisLoad = false;\r\n\tinitData();\r\n\tdraw();\r\n}\r\n\r\nfunction load() {\r\n    console.log('load!!!');\r\n\r\n    clear();\r\n\trenderText('Loading...');\r\n\r\n    isLoad = true;\r\n    move(0);\r\n    callback();\r\n}\r\n\r\nfunction initData() {\r\n\r\n    canvasTrm = HEIGHT;\r\n\r\n    topOffSet = bottomOffSet = 15;\r\n    r1 = r2 = WIDTH / 15; //2个圆直径\r\n\r\n    //圆心坐标\r\n    arc1 = [WIDTH / 2, HEIGHT - bottomOffSet],\r\n        arc2 = [WIDTH / 2, HEIGHT - bottomOffSet];\r\n\r\n    arr1 = [arc2[0] - (r2 / 2), arc2[1]]; //bottom\r\n    arr2 = [WIDTH / 2, arc2[1]]; //center\r\n    arr3 = [arc1[0] - (r1 / 2), arc1[1]]; //top\r\n\r\n    arr4 = [arc2[0] + (r2 / 2), arc2[1]]; //bottom\r\n    arr5 = arr2; //center\r\n    arr6 = [arc1[0] + (r1 / 2), arc1[1]]; //top\r\n\r\n    // console.log()\r\n\r\n}\r\nfunction drawArc() {\r\n    //绘制圆\r\n    context.beginPath();\r\n    context.arc(arc1[0], arc1[1], r1 / 2, 0, 2 * Math.PI);\r\n    context.strokeStyle = drawStyle;\r\n    context.fillStyle = drawStyle;\r\n    context.fill();\r\n\r\n    context.beginPath();\r\n    context.arc(arc2[0], arc2[1], r2 / 2, 0, 2 * Math.PI);\r\n    context.strokeStyle = drawStyle;\r\n    context.fill();\r\n}\r\n\r\nfunction drawBezier() {\r\n    //绘制曲线\r\n    context.beginPath();\r\n    context.moveTo(arr1[0], arr1[1]);\r\n    context.quadraticCurveTo(arr2[0], arr2[1], arr3[0], arr3[1]);\r\n    // context.lineTo(arr4[0],arr4[1]);\r\n    context.lineTo(arr6[0], arr6[1]);\r\n    context.quadraticCurveTo(arr5[0], arr5[1], arr4[0], arr4[1]);\r\n\r\n    context.lineTo(arr1[0], arr1[1]);\r\n    // context.lineTo(arr6[0], arr6[1]);\r\n    // context.lineTo(arr1[0], arr1[1]);\r\n\r\n    context.strokeStyle = drawStyle;\r\n    context.fillStyle = drawStyle;\r\n    context.fill();\r\n}\r\n\r\nfunction renderText(text) {\r\n\tcontext.font = \"12px\";\r\n\tcontext.textAlign = \"center\";\r\n  \tcontext.fillText(text, WIDTH / 2, HEIGHT / 2);\r\n}\r\n\r\nfunction draw() {\r\n    // context.clearRect(0, 0, WIDTH, HEIGHT);\r\n    clear();\r\n    drawArc();\r\n    drawBezier();\r\n}\r\n\r\nfunction clear() {\r\n\tcontext.clearRect(0, 0, WIDTH, HEIGHT);\r\n}\r\n\r\nfunction loop(y) {\r\n\r\n    console.log(y);\r\n    arc1 = [arc1[0], arc1[1] - y];\r\n\r\n    arr1 = [arc2[0] - (r2 / 2), arc2[1]];\r\n    arr3 = [arc1[0] - (r1 / 2), arc1[1]];\r\n    arr4 = [arc2[0] + (r2 / 2), arc2[1]];\r\n    arr5 = [WIDTH / 2, ((arc2[1] - arc1[1]) / 2) + arc1[1]];\r\n    arr6 = [arc1[0] + (r1 / 2), arc1[1]];\r\n    arr2 = arr5;\r\n    draw();\r\n\r\n}\r\n\r\nfunction move(y) {\r\n\tif(y > 100 || y < 0) return;\r\n    body.style.transform = \"translate(0,-\" + y + \"px)\";\r\n}\r\n\r\n\r\ndocument.addEventListener('touchstart', function(e) {\r\n    // e.preventDefault();\r\n    if(isLoad) return;\r\n    y = e.pageY || e.touches[0].pageY;\r\n    // console.log(y);\r\n}, false);\r\n\r\ndocument.addEventListener('touchmove', function(e) {\r\n    // e.preventDefault();\r\n    if(isLoad) return;\r\n    y1 = e.pageY || e.touches[0].pageY;\r\n    disY = y1 - y > 0 ? 1 : -1;\r\n    y = y1;\r\n\r\n    canvasTrm -= disY;\r\n\r\n    // body.style.transform = \"translate(0,-\" + canvasTrm + \"px)\";\r\n    move(canvasTrm);\r\n\r\n    if (canvasTrm < 10) {\r\n        //开启加载\r\n        load();\r\n        return;\r\n    }\r\n\r\n\r\n    if (arc1[1] <= topOffSet || arc1[1] > HEIGHT - bottomOffSet || canvasTrm > 70) return;\r\n    r2 = r2 - disY / 5;\r\n    r1 = r1 - disY / 8;\r\n    loop(disY);\r\n}, false);\r\n\r\ndocument.addEventListener('touchend', function(e) {\r\n    // body.style.transform = \"translate(0,-\" + HEIGHT + \"px)\";\r\n    if(isLoad) return;\r\n    move(HEIGHT);\r\n    initData();\r\n    draw();\r\n});"],"names":["init","opt","callback","initData","draw","end","move","HEIGHT","isLoad","load","console","log","clear","renderText","canvasTrm","topOffSet","bottomOffSet","r1","r2","WIDTH","arc1","arc2","arr1","arr2","arr3","arr4","arr5","arr6","drawArc","context","beginPath","arc","Math","PI","strokeStyle","drawStyle","fillStyle","fill","drawBezier","moveTo","quadraticCurveTo","lineTo","text","font","textAlign","fillText","clearRect","loop","y","body","style","transform","let","window","innerWidth","y1","disY","canvas","document","createElement","width","height","borderBottom","insertBefore","firstChild","const","getContext","addEventListener","e","pageY","touches"],"mappings":"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"}