{"version":3,"file":"pullDownRefresh.js","sources":["../src/pullDownRefresh.js"],"sourcesContent":["let WIDTH = window.innerWidth,\r\n    HEIGHT = 100,\r\n    drawStyle = '#b1b1b1',\r\n    canvasTrm,\r\n    topOffSet, bottomOffSet,\r\n    r1, r2,\r\n    arc1, arc2,\r\n    arr1, arr2, arr3,\r\n    arr4, arr5, arr6,\r\n    y, y1, disY,\r\n    isLoad = false;\r\n\r\nlet callback;\r\n\r\nconst canvas = document.createElement('canvas'),\r\n\t  body = document.body;\r\n\t  canvas.width = WIDTH;\r\n\t  canvas.height = HEIGHT;\r\n\t  canvas.style.borderBottom = \"1px solid #ccc\";\r\n\t  // canvas.style.position = \"\"\r\n\t  body.style.transform = \"translate(0,-\" + HEIGHT + \"px)\";\r\nbody.insertBefore(canvas, body.firstChild);\r\n\r\n// console.log(canvas);\r\nconst context = canvas.getContext('2d');\r\n\r\nexport function init(opt) {\r\n\tcallback = opt.callback;\r\n    initData();\r\n    draw();\r\n}\r\n\r\nexport function end() {\r\n\t// console.log('end');\r\n\tmove(HEIGHT);\r\n\tisLoad = false;\r\n\tinitData();\r\n\tdraw();\r\n}\r\n\r\nfunction load() {\r\n    console.log('load!!!');\r\n\r\n    clear();\r\n\trenderText('Loading...');\r\n\r\n    isLoad = true;\r\n    move(0);\r\n    callback();\r\n}\r\n\r\nfunction initData() {\r\n\r\n    canvasTrm = HEIGHT;\r\n\r\n    topOffSet = bottomOffSet = 15;\r\n    r1 = r2 = WIDTH / 15; //2个圆直径\r\n\r\n    //圆心坐标\r\n    arc1 = [WIDTH / 2, HEIGHT - bottomOffSet],\r\n        arc2 = [WIDTH / 2, HEIGHT - bottomOffSet];\r\n\r\n    arr1 = [arc2[0] - (r2 / 2), arc2[1]]; //bottom\r\n    arr2 = [WIDTH / 2, arc2[1]]; //center\r\n    arr3 = [arc1[0] - (r1 / 2), arc1[1]]; //top\r\n\r\n    arr4 = [arc2[0] + (r2 / 2), arc2[1]]; //bottom\r\n    arr5 = arr2; //center\r\n    arr6 = [arc1[0] + (r1 / 2), arc1[1]]; //top\r\n\r\n    // console.log()\r\n\r\n}\r\nfunction drawArc() {\r\n    //绘制圆\r\n    context.beginPath();\r\n    context.arc(arc1[0], arc1[1], r1 / 2, 0, 2 * Math.PI);\r\n    context.strokeStyle = drawStyle;\r\n    context.fillStyle = drawStyle;\r\n    context.fill();\r\n\r\n    context.beginPath();\r\n    context.arc(arc2[0], arc2[1], r2 / 2, 0, 2 * Math.PI);\r\n    context.strokeStyle = drawStyle;\r\n    context.fill();\r\n}\r\n\r\nfunction drawBezier() {\r\n    //绘制曲线\r\n    context.beginPath();\r\n    context.moveTo(arr1[0], arr1[1]);\r\n    context.quadraticCurveTo(arr2[0], arr2[1], arr3[0], arr3[1]);\r\n    // context.lineTo(arr4[0],arr4[1]);\r\n    context.lineTo(arr6[0], arr6[1]);\r\n    context.quadraticCurveTo(arr5[0], arr5[1], arr4[0], arr4[1]);\r\n\r\n    context.lineTo(arr1[0], arr1[1]);\r\n    // context.lineTo(arr6[0], arr6[1]);\r\n    // context.lineTo(arr1[0], arr1[1]);\r\n\r\n    context.strokeStyle = drawStyle;\r\n    context.fillStyle = drawStyle;\r\n    context.fill();\r\n}\r\n\r\nfunction renderText(text) {\r\n\tcontext.font = \"12px\";\r\n\tcontext.textAlign = \"center\";\r\n  \tcontext.fillText(text, WIDTH / 2, HEIGHT / 2);\r\n}\r\n\r\nfunction draw() {\r\n    // context.clearRect(0, 0, WIDTH, HEIGHT);\r\n    clear();\r\n    drawArc();\r\n    drawBezier();\r\n}\r\n\r\nfunction clear() {\r\n\tcontext.clearRect(0, 0, WIDTH, HEIGHT);\r\n}\r\n\r\nfunction loop(y) {\r\n\r\n    console.log(y);\r\n    arc1 = [arc1[0], arc1[1] - y];\r\n\r\n    arr1 = [arc2[0] - (r2 / 2), arc2[1]];\r\n    arr3 = [arc1[0] - (r1 / 2), arc1[1]];\r\n    arr4 = [arc2[0] + (r2 / 2), arc2[1]];\r\n    arr5 = [WIDTH / 2, ((arc2[1] - arc1[1]) / 2) + arc1[1]];\r\n    arr6 = [arc1[0] + (r1 / 2), arc1[1]];\r\n    arr2 = arr5;\r\n    draw();\r\n\r\n}\r\n\r\nfunction move(y) {\r\n\tif(y > 100 || y < 0) return;\r\n    body.style.transform = \"translate(0,-\" + y + \"px)\";\r\n}\r\n\r\n\r\ndocument.addEventListener('touchstart', function(e) {\r\n    // e.preventDefault();\r\n    if(isLoad) return;\r\n    y = e.pageY || e.touches[0].pageY;\r\n    // console.log(y);\r\n}, false);\r\n\r\ndocument.addEventListener('touchmove', function(e) {\r\n    // e.preventDefault();\r\n    if(isLoad) return;\r\n    y1 = e.pageY || e.touches[0].pageY;\r\n    disY = y1 - y > 0 ? 1 : -1;\r\n    y = y1;\r\n\r\n    canvasTrm -= disY;\r\n\r\n    // body.style.transform = \"translate(0,-\" + canvasTrm + \"px)\";\r\n    move(canvasTrm);\r\n\r\n    if (canvasTrm < 10) {\r\n        //开启加载\r\n        load();\r\n        return;\r\n    }\r\n\r\n\r\n    if (arc1[1] <= topOffSet || arc1[1] > HEIGHT - bottomOffSet || canvasTrm > 70) return;\r\n    r2 = r2 - disY / 5;\r\n    r1 = r1 - disY / 8;\r\n    loop(disY);\r\n}, false);\r\n\r\ndocument.addEventListener('touchend', function(e) {\r\n    // body.style.transform = \"translate(0,-\" + HEIGHT + \"px)\";\r\n    if(isLoad) return;\r\n    move(HEIGHT);\r\n    initData();\r\n    draw();\r\n});"],"names":["let","const"],"mappings":"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"}