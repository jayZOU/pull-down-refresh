{"version":3,"file":"pullDownRefresh.umd.js","sources":["../src/pullDownRefresh.js"],"sourcesContent":["let WIDTH = window.innerWidth,\r\n    HEIGHT = 100,\r\n    drawStyle = '#b1b1b1',\r\n    canvasTrm,\r\n    topOffSet, bottomOffSet,\r\n    r1, r2,\r\n    arc1, arc2,\r\n    arr1, arr2, arr3,\r\n    arr4, arr5, arr6,\r\n    y, y1, disY,\r\n    isLoad = false;\r\n\r\nlet callback;\r\n\r\nconst canvas = document.createElement('canvas'),\r\n\t  body = document.body;\r\n\t  canvas.width = WIDTH;\r\n\t  canvas.height = HEIGHT;\r\n\t  canvas.style.borderBottom = \"1px solid #ccc\";\r\n\t  // canvas.style.position = \"\"\r\n\t  body.style.transform = \"translate(0,-\" + HEIGHT + \"px)\";\r\nbody.insertBefore(canvas, body.firstChild);\r\n\r\n// console.log(canvas);\r\nconst context = canvas.getContext('2d');\r\n\r\nexport function init(opt) {\r\n\tcallback = opt.callback;\r\n    initData();\r\n    draw();\r\n}\r\n\r\nexport function end() {\r\n\t// console.log('end');\r\n\tmove(HEIGHT);\r\n\tisLoad = false;\r\n\tinitData();\r\n\tdraw();\r\n}\r\n\r\nfunction load() {\r\n    console.log('load!!!');\r\n\r\n    clear();\r\n\trenderText('Loading...');\r\n\r\n    isLoad = true;\r\n    move(0);\r\n    callback();\r\n}\r\n\r\nfunction initData() {\r\n\r\n    canvasTrm = HEIGHT;\r\n\r\n    topOffSet = bottomOffSet = 15;\r\n    r1 = r2 = WIDTH / 15; //2个圆直径\r\n\r\n    //圆心坐标\r\n    arc1 = [WIDTH / 2, HEIGHT - bottomOffSet],\r\n        arc2 = [WIDTH / 2, HEIGHT - bottomOffSet];\r\n\r\n    arr1 = [arc2[0] - (r2 / 2), arc2[1]]; //bottom\r\n    arr2 = [WIDTH / 2, arc2[1]]; //center\r\n    arr3 = [arc1[0] - (r1 / 2), arc1[1]]; //top\r\n\r\n    arr4 = [arc2[0] + (r2 / 2), arc2[1]]; //bottom\r\n    arr5 = arr2; //center\r\n    arr6 = [arc1[0] + (r1 / 2), arc1[1]]; //top\r\n\r\n    // console.log()\r\n\r\n}\r\nfunction drawArc() {\r\n    //绘制圆\r\n    context.beginPath();\r\n    context.arc(arc1[0], arc1[1], r1 / 2, 0, 2 * Math.PI);\r\n    context.strokeStyle = drawStyle;\r\n    context.fillStyle = drawStyle;\r\n    context.fill();\r\n\r\n    context.beginPath();\r\n    context.arc(arc2[0], arc2[1], r2 / 2, 0, 2 * Math.PI);\r\n    context.strokeStyle = drawStyle;\r\n    context.fill();\r\n}\r\n\r\nfunction drawBezier() {\r\n    //绘制曲线\r\n    context.beginPath();\r\n    context.moveTo(arr1[0], arr1[1]);\r\n    context.quadraticCurveTo(arr2[0], arr2[1], arr3[0], arr3[1]);\r\n    // context.lineTo(arr4[0],arr4[1]);\r\n    context.lineTo(arr6[0], arr6[1]);\r\n    context.quadraticCurveTo(arr5[0], arr5[1], arr4[0], arr4[1]);\r\n\r\n    context.lineTo(arr1[0], arr1[1]);\r\n    // context.lineTo(arr6[0], arr6[1]);\r\n    // context.lineTo(arr1[0], arr1[1]);\r\n\r\n    context.strokeStyle = drawStyle;\r\n    context.fillStyle = drawStyle;\r\n    context.fill();\r\n}\r\n\r\nfunction renderText(text) {\r\n\tcontext.font = \"12px\";\r\n\tcontext.textAlign = \"center\";\r\n  \tcontext.fillText(text, WIDTH / 2, HEIGHT / 2);\r\n}\r\n\r\nfunction draw() {\r\n    // context.clearRect(0, 0, WIDTH, HEIGHT);\r\n    clear();\r\n    drawArc();\r\n    drawBezier();\r\n}\r\n\r\nfunction clear() {\r\n\tcontext.clearRect(0, 0, WIDTH, HEIGHT);\r\n}\r\n\r\nfunction loop(y) {\r\n\r\n    console.log(y);\r\n    arc1 = [arc1[0], arc1[1] - y];\r\n\r\n    arr1 = [arc2[0] - (r2 / 2), arc2[1]];\r\n    arr3 = [arc1[0] - (r1 / 2), arc1[1]];\r\n    arr4 = [arc2[0] + (r2 / 2), arc2[1]];\r\n    arr5 = [WIDTH / 2, ((arc2[1] - arc1[1]) / 2) + arc1[1]];\r\n    arr6 = [arc1[0] + (r1 / 2), arc1[1]];\r\n    arr2 = arr5;\r\n    draw();\r\n\r\n}\r\n\r\nfunction move(y) {\r\n\tif(y > 100 || y < 0) return;\r\n    body.style.transform = \"translate(0,-\" + y + \"px)\";\r\n}\r\n\r\n\r\ndocument.addEventListener('touchstart', function(e) {\r\n    // e.preventDefault();\r\n    if(isLoad) return;\r\n    y = e.pageY || e.touches[0].pageY;\r\n    // console.log(y);\r\n}, false);\r\n\r\ndocument.addEventListener('touchmove', function(e) {\r\n    // e.preventDefault();\r\n    if(isLoad) return;\r\n    y1 = e.pageY || e.touches[0].pageY;\r\n    disY = y1 - y > 0 ? 1 : -1;\r\n    y = y1;\r\n\r\n    canvasTrm -= disY;\r\n\r\n    // body.style.transform = \"translate(0,-\" + canvasTrm + \"px)\";\r\n    move(canvasTrm);\r\n\r\n    if (canvasTrm < 10) {\r\n        //开启加载\r\n        load();\r\n        return;\r\n    }\r\n\r\n\r\n    if (arc1[1] <= topOffSet || arc1[1] > HEIGHT - bottomOffSet || canvasTrm > 70) return;\r\n    r2 = r2 - disY / 5;\r\n    r1 = r1 - disY / 8;\r\n    loop(disY);\r\n}, false);\r\n\r\ndocument.addEventListener('touchend', function(e) {\r\n    // body.style.transform = \"translate(0,-\" + HEIGHT + \"px)\";\r\n    if(isLoad) return;\r\n    move(HEIGHT);\r\n    initData();\r\n    draw();\r\n});"],"names":["init","opt","callback","initData","draw","end","move","HEIGHT","isLoad","load","console","log","clear","renderText","canvasTrm","topOffSet","bottomOffSet","r1","r2","WIDTH","arc1","arc2","arr1","arr2","arr3","arr4","arr5","arr6","drawArc","context","beginPath","arc","Math","PI","strokeStyle","drawStyle","fillStyle","fill","drawBezier","moveTo","quadraticCurveTo","lineTo","text","font","textAlign","fillText","clearRect","loop","y","body","style","transform","let","y1","disY","window","innerWidth","canvas","document","createElement","width","height","borderBottom","insertBefore","firstChild","const","getContext","addEventListener","e","pageY","touches"],"mappings":"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"}